{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Postgres Configuration",
  "description": "Configuration for Managed Postgres resource",
  "type": "object",
  "required": [
    "name",
    "instanceType",
    "storage"
  ],
  "properties": {
    "name": {
      "type": "string",
      "description": "Postgres instance name",
      "pattern": "^[a-z][a-z0-9-]*$",
      "minLength": 1,
      "maxLength": 63
    },
    "instanceType": {
      "type": "string",
      "description": "Instance type for resource sizing",
      "enum": [
        "db.t3.micro",
        "db.t3.small",
        "db.t3.medium",
        "db.m5.large"
      ]
    },
    "postgresVersion": {
      "type": "integer",
      "description": "Postgres major version",
      "default": 16,
      "enum": [
        13,
        14,
        15,
        16
      ]
    },
    "storage": {
      "type": "object",
      "description": "Storage configuration",
      "required": [
        "size"
      ],
      "properties": {
        "size": {
          "type": "string",
          "description": "Storage size (e.g., 10Gi)",
          "pattern": "^\\d+(Gi|Mi)$"
        },
        "storageClassName": {
          "type": "string",
          "description": "Storage Class Name"
        }
      }
    },
    "ha": {
      "type": "object",
      "description": "High Availability configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable HA (multi-replica)",
          "default": false
        },
        "replicas": {
          "type": "integer",
          "description": "Number of replicas (ignored if ha.enabled is false)",
          "default": 1
        }
      }
    },
    "backup": {
      "type": "object",
      "description": "Backup configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable automated backups",
          "default": true
        },
        "schedule": {
          "type": "string",
          "description": "Cron schedule for backups",
          "default": "0 1 * * *"
        },
        "retain": {
          "type": "integer",
          "description": "Number of backups to retain",
          "default": 7
        }
      }
    }
  }
}
